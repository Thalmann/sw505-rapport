\section{HiTechnic NXT Compass Sensor}
Kompasset fra HiTechnic er et digitalt kompas der måler jordens magnetiske felt.
Kompasset kan returnere en værdi der repræsenterer kompassets nuværende orientering.
Ifølge HiTechnic er værdierne returneret fra kompasset præcise ned til 1 grad.
Kalibrering skulle desuden ikke være nødvendig.
Dog er det nødvendigt for at minimere forstyrrelser, at kompasset holdes 10-15 cm væk fra forstyrrende elementer, herunder \lego NXT og motorer.\cite{hitechnic_compass}

I \cref{kompas:precision} undersøges hvorvidt målinger fra kompasset kan leve op til disse oplysninger.

\subsection{Compass Sensor i \mindsqualls}
Til at styre denne sensor i \mindsqualls, skal der bruges en af de seperate klasser til HiTechnic sensorerne, som findes i namespacet \lstinline[style=csharp]!NXT.MindSqualls.HiTechnic!.
Til kompas sensoren anvendes klassen \lstinline[style=csharp]!HiTechnicCompassSensor!.

\subsubsection{Aflæsning af værdier}
Kompas sensoren aflæses som alle andre sensorer, da den også arver fra \lstinline[style=csharp]!Pollable!-klassen.
Ved aflæsning af egenskaben \lstinline[style=csharp]!Heading!, gives et ulige heltal mellem 0 og 359.\footnote{Det har været nødvendigt at ændre implementationen af Heading for at aflæse kompassets værdi eksakt.
Se \cref{} for yderliger detaljer.\mikkel{Det skal beskrives hvilke ændringer der er lavet til klassen og hvorfor - jeg tænker at det bare skal i appendix.}}
Et eksempel på en simpel aflæsning af værdi kan ses i \cref{kompas:kode_eksempel}.

\begin{figure}[h]
\begin{lstlisting}[style=csharpsmall,caption={Et eksempel på brug af Compass Sensor},label=kompas:kode_eksempel,frame=single]
HiTechnicCompassSensor compas =
	new HiTechnicCompassSensor();
	
/* Instansiering af NxtBrick og forbindelse til NXT */

compas.Poll();
Console.WriteLine(compas.Heading);
\end{lstlisting}
\end{figure}

\subsection{Præcisionstest}\label{kompas:precision}
For at teste kompas sensoren, er målinger taget fra denne og holdt sammen med målinger foretaget med vinkelmåler.
Sammenligningen er sket ved at tage to målinger med kompasset, og sammenligne differencen med den værdi målt med vinkelmåler.
I forbindelse med test af sensoren blev der udført i alt tre tests:
\begin{enumerate}
\item Kompas monteret på robot med hjul
\item Kompas monteret på fast konstruktion
\item Gentagelse af test 2, med \textit{øget præcision}
\end{enumerate}
Den øgede præcision der beskrives her, dækker over en opdatering af \mindsqualls klassen \lstinline[style=csharp]!HiTechnicCompassSensor! der blev foretaget efter de første to tests.
Resultaterne fra de tre tests kan ses i tabellerne \ref{kompas:test1:table}, \ref{kompas:test2:table} og \ref{kompas:test3:table} på side \pageref{kompas:test1:table}.

Af resultaterne er der lavet et boksplot for hver test, hvor prikkerne på plottet repræsenterer den gennemsnitlige afvigelse.
Koden der blev kørt til udførelse af tests kan ses i \cref{kompas:kode_test}.

\begin{figure}[h]
\begin{lstlisting}[style=csharpsmall,caption={Kode brugt til test},label=kompas:kode_test,frame=single]
NxtBrick brick = new NxtBrick(NxtCommLinkType.Bluetooth, 8);
HiTechnicCompassSensor compas = new HiTechnicCompassSensor();
brick.Sensor1 = compas;

brick.Connect();

compas.OnPolled += pollable =>
	Console.WriteLine("Heading: {0}",
	(pollable as HiTechnicCompassSensor).Heading);
compas.PollInterval = 1000;

Console.ReadKey();

brick.Disconnect();
\end{lstlisting}
\end{figure}

\subsubsection{Test 1 - På robot}
Første forsøg blev udført med kompasset monteret ovenpå ultralyds-sensoren, for at holde en minimum-afstand på 15 cm fra brick og motorer.
Denne konstruktion var dog meget ustabil, da kompasset skulle være forholdsvist højt oppe ift. base-konstruktionen.
En oversigt over resultaterne er givet i \cref{kompas:test1:table}.

\begin{description}
\item[Største afvigelse]{8\dg}
\item[Mindste afvigelse]{0\dg}
\item[Gennemsnitlig afvigelse]{2.67}
\end{description}

\begin{figure}[h]
\centering
\begin{tikzpicture}[thick]
\draw(1,0) rectangle (3,1); % Boks
\draw (2,0) -- (2,1); % Median streg
\draw (3,0.5) -- (8,0.5); % Fra øvre kvartil til maks
\draw (1,0.5) -- (0,0.5);% Fra nedre kvartil til min
\draw (8,0.3) -- (8,0.7); % Maksimum vertikal streg
\draw (0,0.3) -- (0,0.7); % Minimum vertikal streg
\filldraw[color=black] (2.67,0.5) circle (0.05cm); % Gennemsnittet

% Linje med værdier
\draw (0,-1) -- (10,-1);
\draw[snake=ticks,segment length=1cm] (0,-1) -- (10,-1);

% Tal på linje
\node[below] at (0,-1.1) {$0$};
\node[below] at (1,-1.1) {$1$};
\node[below] at (2,-1.1) {$2$};
\node[below] at (3,-1.1) {$3$};
\node[below] at (4,-1.1) {$1$};
\node[below] at (5,-1.1) {$2$};
\node[below] at (6,-1.1) {$3$};
\node[below] at (7,-1.1) {$3$};
\node[below] at (8,-1.1) {$8$};
\end{tikzpicture}
\caption{Boksplot for Test 1}
\label{kompas:test1:boksplot}
\end{figure}

\subsubsection{Test 2 - På stabil konstruktion}
Andet forsøg blev udført med kompasset monteret på en selvstændig og langt mere stabil konstruktion, for at se om dette ville kunne forbedre resultaterne.
Disse resultater kan ses i \cref{kompas:test1:table}.

\begin{description}
\item[Største afvigelse]{6\dg}
\item[Mindste afvigelse]{0\dg}
\item[Gennemsnitlig afvigelse]{1.66}
\end{description}

\input{./analyse/kompas_table2}

\begin{figure}[h]
\centering
\begin{tikzpicture}[thick]
\draw(0.5,0) rectangle (2.5,1); % Boks
\draw (1.5,0) -- (1.5,1); % Median streg
\draw (2.5,0.5) -- (6,0.5); % Fra øvre kvartil til maks
\draw (0.5,0.5) -- (0,0.5);% Fra nedre kvartil til min
\draw (6,0.3) -- (6,0.7); % Maksimum vertikal streg
\draw (0,0.3) -- (0,0.7); % Minimum vertikal streg
\filldraw[color=black] (1.66,0.5) circle (0.05cm); % Gennemsnittet

% Linje med værdier
\draw (0,-1) -- (10,-1);
\draw[snake=ticks,segment length=1cm] (0,-1) -- (10,-1);

% Tal på linje
\node[below] at (0,-1.1) {$0$};
\node[below] at (1,-1.1) {$1$};
\node[below] at (2,-1.1) {$2$};
\node[below] at (3,-1.1) {$3$};
\node[below] at (8,-1.1) {$8$};
\end{tikzpicture}
\caption{Boksplot for Test 1}
\label{kompas:test1:boksplot}
\end{figure}
