\section{Lokalisering af robot}
\mikkel{Hvor gør vi opmærksom på at vi vil anvende en kinect?}
Til lokalisering af robotten anvendes (som nævnt i \cref{}) en \kinect.
Denne er udstyret med et farvekamera (jvf. \cref{kinect:farvekamera}) der vil blive anvendt til at bestemme robottens placering.
Ved at udstyre robotten med to mærkninger i klare farver vil det på billeder fra kinect'en være muligt at lokalisere robotten.
I det følgende beskrives den anvendte metode til lokalisering af robotten.
Først beskrives den overordnede metode, hvorefter forbedringer af metoden præsenteres.

\subsection{Farveforskel}
%Beskrivelse af den metode der anvendes til at beskrive forskellen mellem farver
Lokalisering af robotten foretages som udgangspunkt ud fra \'et billede.
Det vil sige, at systemet skal være i stand til at lokalisere robotten ud fra \'et billede alene.
Som beskrevet ovenfor udstyres robotten med to mærkninger i klare farver som skal spores.
Det er altså målet at finde de dele af et enkelt billede der matcher bestemte farver.

\paragraph{Match af farver}
For at vurdere om to farver matcher hinanden må det først gøres klart at det ikke kan forventes at matche en farve eksakt.
Til dette spiller faktorer som lys og skygge for stor en rolle.
Istedet tages der udgangspunkt i en søgt farve og ud fra denne ledes der efter alle \textit{nære} farver.
Til dette formål betragtes den farve-repræsentation der arbejdes med.
Farver repræsenteres ved tre værdier; rød, grøn og blå (også kaldet RGB), der angiver alle de mulige farver for en pixel i et billede.
Ved at betragte de tre farver som hver sin dimension i et tredimensionelt rum kan farver repræsenteres som vektorer.
Hermed bliver det muligt at tale om forskellen på to farver som \textit{afstanden mellem to farver}.

\begin{figure}
\centering
\input{./analyse/fig_3dcolor}
\caption{To farver repræsenteret i et tredimensionelt rum}
\label{tracking:colorspace}
\end{figure}

På \cref{tracking:colorspace} ses et eksempel på afstanden mellem to farver.
Her er farverne $C_1$ og $C_2$ illustreret med vektorer.
Forskellen på de to farver udtrykkes ved længden af differencen mellem de to.
Altså har vi, for to farver $C_a$ og $C_b$, følgende afstand:
\begin{equation}
dist_{C_aC_b} = |C_a - C_b|
\end{equation}
Hver af de tre RGB farver repræsenteres ved 1 byte og afstanden mellem to farver kan derfor højst være $\sqrt{3 \cdot 255^2}$ (forskellen på hvid og sort).

\paragraph{Maksimal afstand}
Det er dog kun interessant at kigge på de farver der ligger i en vis afstand af hinanden.
Der indføres derfor en konstant $\rho$ der definerer et maksimum for hvor langt to farver må være fra hinanden før de ikke længere er interssante.
I \cref{tracking:adjust} beskrives bestemmelsen af denne konstant.
Med $\rho$ i mente kan der udregnes en vægt, der bestemmer hvor interessant en farve er i forhold til en anden farve.
Lad $C_a$ og $C_b$ være to farver, da har vi:
\begin{equation}
w_{C_aC_b} = \left\{ 
  \begin{array}{r l}
        0 & \quad \text{hvis $dist_{C_aC_b} > \rho$} \\
       1 - \frac{dist_{C_aC_b}}{\rho} & \quad \text{hvis $dist_{C_aC_b} \leq \rho$}
  \end{array} \right.
\end{equation}
Her udtrykker $w_{C_aC_b}$ vægten af interesse for $C_b$ i forhold til $C_a$.
Det følger desuden af ovenstående, at $w_{C_aC_b} \in [0;1]$ for ethvert par af farver.

Ved at undersøge alle pixels i et billede fra kinect'en ud fra en bestemt farve kan vægten af alle pixels bestemmes.
Vægten af en pixel beskriver hvor interessant den er.
Således er pixels med vægt 0 ikke interessante.
De resterende pixels betegnes herefter som \emph{interessante pixels}.

\mikkel{Indsæt evt. sort/hvid billede af tracking}

Ved at finde den mindste firkant der spænder over alle interessante pixels og udvælge dens centrum kan farvens (og dermed robottens) \textit{position} nu bestemmes.

\subsection{Forbedringer}
For at teste implementationen af ovenstående blev det forsøgt at lokalisere forskellige farver for varierende $\rho$-værdier.
Af dette fremgik det tydeligt at metoden var effektiv til genkendelse af farver.
Der blev dog ved testen introduceret tre problemstillinger:
\begin{enumerate}
\item Dele af billedet indeholdt \emph{farve-støj}.
Ved farvestøj forstås pixels der ligger i tæt farve-afstand til den søgte farve, men langt fra det eftersøgte objekt.
\item Farveændringer som følge af lys/skygge.
I takt med at robotten bevæger sig vil lys falde forskelligt på de farvede overflade.
Dette betyder at farven opfanget af kameraet ikke længere matcher den søgte farve godt.
Ofte kan robotten ikke spores hvis belysningen ændres for meget.
\item Funktionens opdaterings hastighed var ikke tilfredsstillinde (0-3 billeder i sekundet).
Omend intet krav var stillet til opdaterings hastigheden er det dog nødvendigt til enhver tid at kunne beskrive robottens lokation.
Ved lave opdaterings hastigheder bliver ændringerne i robottens lokation for høje (robotten flytter sig op til 30 cm mellem to billeder).
\end{enumerate}

I det følgende beskrives de metoder der er anvendt til at løse ovenstående problemstillinger.
I \cref{tracking:adjust} beskrives resultatet af indførelsen af disse metoder.

\subsubsection{Filtrering af støj}
%Beskrivelse af implementationen af mean-filter
Den beskrevne \emph{farve-støj} der opstår i visse billeder fjernes ved at anvende en variation af et 3x3 median-filter\cite{medianfilter}.
I filteret betragtes alle værdier som binære (0 eller ikke 0).
Midten af boksen erstattes af 0 hvis kun få naboer ikke har værdien 0.
Variablen $\sigma$ indføres her til at beskrive ''få naboer``.
Lad $w_{x,y}$ beskrive værdien vægten af den pixel i et billede der har koordinat-sæt $x,y$ og $N_{x,y}$ beskrive de \emph{højst} 8 nabo-vægte til dette koordinat-sæt, da kan filteret beskrives således:
\begin{equation}
w_{x,y}' = \left\{ 
  \begin{array}{r l}
        0 & \quad \text{hvis $|V_{x,y}| < \sigma$} \\
        w_{x,y} & \quad \text{hvis $|V_{x,y}| \geq \sigma$}
  \end{array} \right.
\end{equation}
$$\text{hvor } V_{x,y} = \{ w \in N_{x,y} \mid w > 0 \}$$
Ved at anvende ovenstående filter på alle koordinat-sæt fjernes noget af den uønskede farve-støj.
Filteret påføres gentagne gange, indtil ingen vægte opdateres.
Herefter anses støjen som fjernet.

\subsubsection{Farve-afstand}
%Beskrivelse af farve-afstand optimering, ved opdatering af den søgte farve

\subsubsection{Afgrænset område}
%Beskrivelse af opdatering af det område der afsøges

\subsection{Justering}\label{tracking:adjust}
%Beskrivelse af diverse thresholds og hvilke værdier "der fungerer"
\mikkel{Resultater af colortracking-test}